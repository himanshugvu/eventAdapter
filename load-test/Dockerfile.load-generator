FROM openjdk:21-jre-slim

WORKDIR /app

RUN apt-get update && \
    apt-get install -y curl && \
    rm -rf /var/lib/apt/lists/*

COPY target/kafka-load-generator-*.jar app.jar

RUN addgroup --system loadtest && \
    adduser --system --group loadtest

RUN mkdir -p /app/results && chown loadtest:loadtest /app/results

USER loadtest

ENV JAVA_OPTS="-Xmx1g -Xms512m -XX:+UseG1GC"

ENTRYPOINT ["sh", "-c", "java $JAVA_OPTS -jar app.jar"]